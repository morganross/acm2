# FUCKING-LIVE-STAT-9-2: META REPORT

**Date**: December 20, 2025
**Context**: Comprehensive post-mortem and status summary for the Live Stats subsystem in ACM2.

## 1. Executive Summary of Subsystem Evolution
The "Live Stats" feature in ACM2 underwent a tumultuous development cycle characterized by deep architectural failures, circular dependencies, and subtle race conditions. What was initially conceived as a simple counter display evolved into a multi-layer engineering challenge involving backend concurrency, WebSocket room management, and frontend state synchronization.

## 2. Critical Milestones & Breakthroughs
- **The `--json` Flag**: Fixed the "Output Too Small" retry loop crisis where FPF rejected valid evaluation JSONs.
- **Closure-Based Callbacks**: Fixed the `RunExecutor` context loss by capturing `run_id` in lambda closures.
- **WebSocket URL Alignment**: The "million-dollar bug" was a simple path mismatch: `/ws/run/{id}` vs `/api/v1/runs/ws/run/{id}`.
- **Dependency Injection**: Refactored `RunExecutor` to accept `RunConnectionManager` to break circular imports.

## 3. Persistent Failings (Current Status)
Despite the "Fully Fixed" status in report #4, reports #7 and #8 reveal deep-seated reliability issues:
1. **Ghost Broadcasts**: Backend continues to broadcast to 0 connected clients because the frontend connection isn't established or is dropped.
2. **Persistence Gap**: Live stats are still ephemeral. Refreshing the page mid-run results in "No stats" because they are not yet stored in the database.
3. **Timeout Enforcement**: Configured 600s timeouts are being ignored, with heartbeats reaching 1170s+ without termination.
4. **Parsing Fragility**: Even with `--json`, some outputs fail parsing, leading to retries that aren't properly reported in the live stats.
5. **Phase Drift**: The UI/Stats reported "current_phase" lags behind the actual execution state.

## 4. Technical Debt Assessment
- **Sync/Async Bridge**: The current `FpfStatsTracker` callback mechanism uses `loop.create_task` from sync code, which is prone to event loop mismatches.
- **Error Recovery**: `last_error` in the tracker is sticky; successful subsequent calls do not clear previous error messages.
- **Heartbeat Math**: The heartbeat intervals and elapsed time calculations are inconsistent and potentially duplicated.

## 5. Summary of Key Files
- `api_cost_multiplier/acm2/FUCKING-LIVE-STATS.MD`: Initial 100-page failure analysis.
- `api_cost_multiplier/acm2/FUCKING-LIVE-STATS-2.MD`: Declaration of success (premature).
- `api_cost_multiplier/acm2/FUCKING-LIVE-STATS-4.MD`: Comprehensive fix report (The URL Path fix).
- `api_cost_multiplier/acm2/FUCKING-LIVE-STATS-7.MD`: Post-fix post-mortem (The 0-connections issue).
- `api_cost_multiplier/FUCKING-LIVE-STAT-8.MD`: Analysis of stalled pipeline and timeout failures.

---
*Report generated by Meta-Analysis of Stats Subsystem Logs.*
